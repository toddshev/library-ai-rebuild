extends ../layout

block content
  h1 Patron: #{patron.first_name} #{patron.last_name}
  form(method='post', action='/patrons/' + patron.id)
    input(type='hidden', name='_method', value='PUT')
    if errors && errors.length
      h2.error Oooops!
      ul.error
        each msg in errors
          li= msg
    p
      label(for='first_name') First Name
      input#first_name(name='first_name', type='text', value=patron.first_name || '', required)
    p
      label(for='last_name') Last Name
      input#last_name(name='last_name', type='text', value=patron.last_name || '', required)
    p
      label(for='address') Address
      input#address(name='address', type='text', value=patron.address || '', required)
    p
      label(for='email') Email
      input#email(name='email', type='email', value=patron.email || '', required)
    p
      label(for='library_id') Library ID
      input#library_id(name='library_id', type='text', value=patron.library_id || '', required)
    p
      label(for='zip_code') Zip Code
      input#zip_code(name='zip_code', type='text', value=patron.zip_code || '', required)
    p
      input(type='submit', value='Update')

  h2 Loan History
  - var patronLoans = loans || patron.loans || []
  if patronLoans.length
    table
      thead
        tr
          th Book
          th Loaned on
          th Return by
          th Returned on
          th Action
      tbody
        each loan in patronLoans
          tr
            td
              if loan.Book
                a(href='/books/' + loan.Book.id)= loan.Book.title
              else
                | —
            td= loan.loaned_on || '—'
            td= loan.return_by || '—'
            td= loan.returned_on || '—'
            td
              if !loan.returned_on
                a.button(href='/loans/' + loan.id + '/return') Return Book
  else
    p No loans yet.
